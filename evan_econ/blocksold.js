"History"in INK==0&&(INK.History=function(){this.$=INK.$,INK.History.count++,this.URL_CHECK_INTERVAL=500,this.USE_IFRAME=this.$.browser.msie&&this.$.browser.version<8,this.handlers=[],this.defaultCallback=null,this.hash=window.location.hash,this.checkURL=this.$.proxy(this.checkURL,this);if(INK.History.count>1)return;this.$(this.$.proxy(function(){this.USE_IFRAME&&(this.iframe=this.$('<iframe src="javascript:0"/>').hide().appendTo("body")[0].contentWindow),"onhashchange"in window?window.onhashchange=this.checkURL:setInterval(this.checkURL,this.URL_CHECK_INTERVAL)},this))},INK.History.count=0,INK.History.prototype={register:function(a,b){this.handlers.push({matcher:a,callback:b})},save:function(a){if(INK.History.count>1)return;window.location.hash=this.hash=a?"#"+a:"",this.USE_IFRAME&&this.iframe&&this.hash!=this.iframe.location.hash&&(this.iframe.document.open().close(),this.iframe.location.hash=this.hash)},checkURL:function(){if(INK.History.count>1)return;try{var a=(this.USE_IFRAME?this.iframe:window).location.hash}catch(b){}if(!a||a==this.hash||"#"+a==this.hash||a==decodeURIComponent(this.hash))return!1;this.USE_IFRAME&&(window.location.hash=a),this.loadURL(!0)},loadURL:function(a){var b=this.hash=window.location.hash;for(var c=this.handlers.length-1;c>=0;c--){var d=b.match(this.handlers[c].matcher);if(d)return a===!0&&this.handlers[c].callback.apply(this.handlers[c].callback,d.slice(1,d.length)),!0}if(this.defaultCallback==null||a!==!0)return!1;this.defaultCallback()}}),INK.Blocks=function(a,b){this.$=INK.$;var c={$el:this.$(a),History:null,via:"index",history:!1,navSelector:".ink-content-item",blockSelector:".ink-content-block",activeNavClass:"ink-content-item-active",activeBlockClass:"ink-content-block-active",patternPrefix:"panel",URLPattern:null,$navItems:null,$blocks:null,onActivate:function(){return null}};arguments.length>1&&this.$.extend(c,b),this.$.extend(this,c);if(this.$el.length>1)throw"You can only target one content collection at a time";this.init()},INK.Blocks.prototype={init:function(){var a=INK.isMobile()?"touch":"click";return this.$navItems=this.$el.find(this.navSelector),this.$blocks=this.$el.find(this.blockSelector),this.$navItems.on(a,this.$.proxy(this.handleNav,this)),this.history&&(this.URLPattern=new RegExp("#"+this.patternPrefix+"/([a-zA-Z0-9_]*)","i"),this.History=new INK.History(this),this.History.register(this.URLPattern,this.$.proxy(this.activate,this)),this.History.loadURL(!0)),this.$el.find("."+this.activeNavClass).length===0&&this.$(this.$navItems[0])[a](),this},handleNav:function(a){var b,c,d;b=this.$(a.target),c=b.hasClass(this.navSelector.substr(1,this.navSelector.length))?b:b.parents(this.navSelector),d=this.via==="index"?this.$navItems.index(c):c.data(this.via),this.activate(d)},activate:function(a){var b,c,d;return this.via==="index"?(c=this.$(this.$navItems[a]),d=this.$(this.$blocks[a])):(c=this.$el.find(this.navSelector+"[data-"+this.via+'="'+a+'"]'),d=this.$el.find(this.blockSelector+"[data-"+this.via+'="'+a+'"]')),this.$el.find("."+this.activeNavClass).removeClass(this.activeNavClass),c.addClass(this.activeNavClass),this.$el.find("."+this.activeBlockClass).removeClass(this.activeBlockClass),d.addClass(this.activeBlockClass),this.history&&(b=d.data("slug"),this.History.save(this.patternPrefix+"/"+b)),this.onActivate(a),this}};